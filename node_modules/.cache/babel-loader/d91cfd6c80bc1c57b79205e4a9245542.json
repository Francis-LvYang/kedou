{"ast":null,"code":"import \"antd-mobile/lib/toast/style/css\";\nimport _Toast from \"antd-mobile/lib/toast\";\n\nvar _dec,\n    _dec2,\n    _class,\n    _temp,\n    _jsxFileName = \"/Users/Ryan/Projects/kedou/src/pages/VideoDetail/index.js\";\n\nimport DPlayer from 'dplayer';\nimport 'dplayer/dist/DPlayer.min.css';\nimport { createForm } from 'rc-form';\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { withRouter } from 'react-router-dom';\nimport IsLogin from '../../components/login/index';\nimport PublicNavBar from '../../components/PublicNavBar';\nimport { commentLikeApi } from '../../services/videoDetail';\nimport { getChat, getVideoOnePatch } from '../../store/action/videoDetail';\nimport Content from './components/content';\nimport ModalPlayer from './components/ModalPlayer';\nimport './player.less';\nconst mapDispatchToProps = {\n  getVideoOnePatch,\n  getChat\n};\nlet VideoDetail = (_dec = connect(({\n  videoDetailReducer\n}) => ({\n  videoDetailReducer\n}), mapDispatchToProps), _dec2 = createForm(), _dec(_class = withRouter(_class = _dec2(_class = (_temp = class VideoDetail extends Component {\n  constructor(props) {\n    super(props);\n\n    this.getChat = (vId = '') => {\n      const id = this.props.match.params.id;\n      this.props.getChat({\n        user_id: sessionStorage.getItem('user_id'),\n        video_id: vId === '' ? id.split('&')[0] : String(vId),\n        page: '1',\n        rows: '10'\n      });\n    };\n\n    this.getVideo = (videoId = '') => {\n      const id = this.props.match.params.id;\n      const user_id = sessionStorage.getItem('user_id'); //万能ID '9652'  sessionStorage.getItem('user_id')\n\n      const video_id = id.split('&')[0];\n\n      if (user_id === null) {\n        this.setState({\n          noLogin: true\n        });\n      } else {\n        this.setState({\n          noLogin: false\n        });\n        new Promise(resolve => {\n          this.props.getVideoOnePatch({\n            user_id,\n            video_id: videoId === '' ? video_id : videoId,\n            resolve\n          });\n        }).then(res => {\n          if (res.user_fabulous === 0) {\n            this.setState({\n              isCollect: false\n            });\n          } else {\n            this.setState({\n              isCollect: true\n            });\n          }\n\n          if (res.video_url) {\n            this.setState({\n              navBarTitle: res.title.length >= 20 ? res.title.substring(0, 14).concat('...') : res.title,\n              detailData: res\n            });\n            return this.InitDPlayer(res.video_url);\n          }\n\n          if (res.code === '-6') {\n            _Toast.fail(res.err);\n\n            this.InitDPlayer('www.baidu.com');\n            document.querySelector('.dplayer-full-icon').style.display = 'none';\n          }\n        });\n      }\n    };\n\n    this.InitDPlayer = (url = '') => {\n      if (this.dPlayer || this.isLeave) return;\n      this.dp = new DPlayer({\n        container: document.getElementById('dplayer'),\n        lang: 'zh-cn',\n        mutex: true,\n        autoplay: true,\n        loop: false,\n        hotkey: true,\n        preload: 'auto',\n        volume: 0.7,\n        video: {\n          type: 'auto',\n          url: url\n        }\n      });\n    };\n\n    this.onLeftClick = () => {\n      if (sessionStorage.getItem('goBack')) {\n        this.props.history.go(-1);\n      } else {\n        this.props.history.push('/video');\n      }\n    };\n\n    this.showComment = () => {\n      this.setState({\n        visible: true\n      });\n    };\n\n    this.closeLogin = () => {\n      this.setState({\n        noLogin: false\n      });\n      window.location.reload();\n    };\n\n    this.likedClick = () => {\n      const detailData2 = this.state.detailData;\n      const id = this.props.match.params.id;\n      const video_id = id.split('&')[0];\n      commentLikeApi({\n        user_id: sessionStorage.getItem('user_id'),\n        video_id,\n        type: '4'\n      }).then(res => {\n        if (res.err) {\n          _Toast.info('请勿重复点赞', 1);\n\n          return;\n        } else {\n          detailData2.fabulous_video = 1;\n          detailData2.liked_num++;\n          this.setState({\n            detailData: detailData2\n          });\n        }\n      });\n    };\n\n    this.sendMsg = e => {\n      const id = this.props.match.params.id;\n      const user_id = sessionStorage.getItem('user_id'); //万能ID '9652'  sessionStorage.getItem('user_id')\n\n      const video_id = id.split('&')[0];\n\n      if (e.keyCode === 13) {\n        if (this.state.message !== '') {\n          commentLikeApi({\n            user_id,\n            type: '2',\n            video_id,\n            message: this.state.message\n          }).then(res => {\n            if (res.suc) {\n              _Toast.success(res.suc);\n\n              this.setState({\n                message: '',\n                isReload: true\n              });\n            }\n          });\n        } else {\n          return;\n        }\n      }\n    };\n\n    this.cb = () => {\n      // 提交评论后停止重复请求,以及在前台页面模拟数据变化减少数据请求,实际上后台以更新.\n      const detailData = this.state.detailData;\n      detailData.comment_num++;\n      this.setState({\n        isReload: false,\n        detailData\n      });\n    };\n\n    this.saveMsg = e => {\n      this.setState({\n        message: e.target.value\n      });\n    };\n\n    this.collectBtn = () => {\n      const id = this.props.match.params.id;\n      commentLikeApi({\n        user_id: sessionStorage.getItem('user_id'),\n        video_id: id.split('&')[0],\n        type: '1'\n      }).then(res => {\n        switch (res.suc) {\n          case '收藏成功':\n            this.setState({\n              isCollect: true\n            });\n\n            _Toast.success(res.suc, 1, false);\n\n            break;\n\n          case '取消成功':\n            this.setState({\n              isCollect: false\n            });\n\n            _Toast.success(res.suc, 1, false);\n\n            break;\n\n          default:\n            _Toast.success('网络延迟,稍后在试');\n\n            return;\n        }\n      });\n    };\n\n    this.state = {\n      isCollect: false,\n      //是否收藏了\n      isReload: false,\n      //判断是否应该刷新\n      message: '',\n      //留言的内容\n      noLogin: false,\n      detailData: {},\n      navBarTitle: '',\n      isLoading: false,\n      visible: false,\n      display: false,\n      isLiked: false\n    };\n  }\n\n  componentDidMount() {\n    this.getVideo();\n    this.getChat();\n    this.isLeave = false;\n  }\n\n  componentWillUnmount() {\n    this.dPlayer && this.dPlayer.destroy();\n    this.isLeave = true;\n  }\n\n  render() {\n    const videoDetailReducer = this.props.videoDetailReducer;\n    const HotVideoList = videoDetailReducer.HotVideoList;\n    const navBarProps = {\n      title: this.state.navBarTitle,\n      isDetail: true,\n      onLeftClick: this.onLeftClick,\n      display: this.state.display\n    };\n    const contentProps = {\n      likedClick: this.likedClick,\n      isLiked: this.state.isLiked,\n      isCollect: this.state.isCollect,\n      dataList: HotVideoList,\n      router: this.props,\n      getVideo: this.getVideo,\n      getChat: this.getChat,\n      detailData: this.state.detailData,\n      showComment: this.showComment,\n      collectBtn: this.collectBtn\n    };\n    const modalProps = {\n      cb: this.cb,\n      commentNum: this.state.detailData.comment_num,\n      visible: this.state.visible,\n      onClose: () => this.setState({\n        visible: false\n      }),\n      dataSource: this.props.videoDetailReducer.comment,\n      getChat: this.getChat,\n      detailData: this.state.detailData,\n      isReload: this.state.isReload\n    };\n    return React.createElement(\"div\", {\n      className: \"playerIndex\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 251\n      },\n      __self: this\n    }, React.createElement(PublicNavBar, Object.assign({}, navBarProps, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 252\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      onClick: () => this.setState({\n        display: !this.state.display\n      }),\n      id: \"dplayer\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 253\n      },\n      __self: this\n    }), React.createElement(Content, Object.assign({}, contentProps, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 254\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: \"InpBottomSay\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 255\n      },\n      __self: this\n    }, React.createElement(\"i\", {\n      className: \"iconPhoto\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 256\n      },\n      __self: this\n    }), React.createElement(\"input\", {\n      onChange: this.saveMsg,\n      onKeyDown: this.sendMsg,\n      onFocus: () => this.setState({\n        visible: true\n      }),\n      placeholder: \"\\u6211\\u6765\\u8BF4\\u4E24\\u53E5...\",\n      type: \"text\",\n      value: this.state.message,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 257\n      },\n      __self: this\n    })), React.createElement(ModalPlayer, Object.assign({}, modalProps, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 266\n      },\n      __self: this\n    })), this.state.noLogin ? React.createElement(IsLogin, {\n      rightCallBack: this.closeLogin,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 267\n      },\n      __self: this\n    }) : null);\n  }\n\n}, _temp)) || _class) || _class) || _class);\nexport default VideoDetail;","map":{"version":3,"sources":["/Users/Ryan/Projects/kedou/src/pages/VideoDetail/index.js"],"names":["DPlayer","createForm","React","Component","connect","withRouter","IsLogin","PublicNavBar","commentLikeApi","getChat","getVideoOnePatch","Content","ModalPlayer","mapDispatchToProps","VideoDetail","videoDetailReducer","constructor","props","vId","id","match","params","user_id","sessionStorage","getItem","video_id","split","String","page","rows","getVideo","videoId","setState","noLogin","Promise","resolve","then","res","user_fabulous","isCollect","video_url","navBarTitle","title","length","substring","concat","detailData","InitDPlayer","code","fail","err","document","querySelector","style","display","url","dPlayer","isLeave","dp","container","getElementById","lang","mutex","autoplay","loop","hotkey","preload","volume","video","type","onLeftClick","history","go","push","showComment","visible","closeLogin","window","location","reload","likedClick","detailData2","state","info","fabulous_video","liked_num","sendMsg","e","keyCode","message","suc","success","isReload","cb","comment_num","saveMsg","target","value","collectBtn","isLoading","isLiked","componentDidMount","componentWillUnmount","destroy","render","HotVideoList","navBarProps","isDetail","contentProps","dataList","router","modalProps","commentNum","onClose","dataSource","comment"],"mappings":"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","sourcesContent":["// eslint-disable-next-line\nimport { Toast } from 'antd-mobile';\nimport DPlayer from 'dplayer';\nimport 'dplayer/dist/DPlayer.min.css';\nimport { createForm } from 'rc-form';\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { withRouter } from 'react-router-dom';\nimport IsLogin from '../../components/login/index';\nimport PublicNavBar from '../../components/PublicNavBar';\nimport { commentLikeApi } from '../../services/videoDetail';\nimport { getChat, getVideoOnePatch } from '../../store/action/videoDetail';\nimport Content from './components/content';\nimport ModalPlayer from './components/ModalPlayer';\nimport './player.less';\nconst mapDispatchToProps = {\n  getVideoOnePatch, getChat\n};\n\n@connect(({ videoDetailReducer }) => ({\n  videoDetailReducer\n}), mapDispatchToProps)\n@withRouter\n@createForm()\nclass VideoDetail extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isCollect: false,//是否收藏了\n      isReload: false,//判断是否应该刷新\n      message: '',//留言的内容\n      noLogin: false,\n      detailData: {},\n      navBarTitle: '',\n      isLoading: false,\n      visible: false,\n      display: false,\n      isLiked: false\n    }\n  }\n\n  componentDidMount() {\n    this.getVideo()\n    this.getChat()\n    this.isLeave = false;\n  }\n\n  componentWillUnmount() {\n    this.dPlayer && this.dPlayer.destroy();\n    this.isLeave = true;\n  }\n\n  getChat = (vId = '') => {\n    const { id } = this.props.match.params\n    this.props.getChat({\n      user_id: sessionStorage.getItem('user_id'),\n      video_id: vId === '' ? id.split('&')[0] : String(vId),\n      page: '1',\n      rows: '10'\n    })\n  }\n\n  getVideo = (videoId = '') => {\n    const { id } = this.props.match.params\n    const user_id = sessionStorage.getItem('user_id')  //万能ID '9652'  sessionStorage.getItem('user_id')\n    const video_id = id.split('&')[0]\n    if (user_id === null) {\n      this.setState({ noLogin: true })\n    } else {\n      this.setState({ noLogin: false })\n      new Promise((resolve) => {\n        this.props.getVideoOnePatch({ user_id, video_id: videoId === '' ? video_id : videoId, resolve })\n      }).then(res => {\n        if (res.user_fabulous === 0) {\n          this.setState({\n            isCollect: false\n          })\n        } else {\n          this.setState({\n            isCollect: true\n          })\n        }\n        if (res.video_url) {\n          this.setState({\n            navBarTitle: res.title.length >= 20 ? res.title.substring(0, 14).concat('...') : res.title,\n            detailData: res\n          })\n          return this.InitDPlayer(res.video_url)\n        }\n        if (res.code === '-6') {\n          Toast.fail(res.err)\n          this.InitDPlayer('www.baidu.com')\n          document.querySelector('.dplayer-full-icon').style.display = 'none'\n        }\n\n      })\n    }\n  }\n\n  InitDPlayer = (url = '') => {\n    if (this.dPlayer || this.isLeave) return;\n    this.dp = new DPlayer({\n      container: document.getElementById('dplayer'),\n      lang: 'zh-cn',\n      mutex: true,\n      autoplay: true,\n      loop: false,\n      hotkey: true,\n      preload: 'auto',\n      volume: 0.7,\n      video: {\n        type: 'auto',\n        url: url\n      },\n    });\n  }\n\n  onLeftClick = () => {\n    if (sessionStorage.getItem('goBack')) {\n      this.props.history.go(-1)\n    } else {\n      this.props.history.push('/video')\n    }\n  }\n  showComment = () => {\n    this.setState({\n      visible: true\n    })\n  }\n\n  closeLogin = () => {\n    this.setState({ noLogin: false })\n    window.location.reload()\n  }\n\n  likedClick = () => {\n    const detailData2 = this.state.detailData\n    const { id } = this.props.match.params\n    const video_id = id.split('&')[0]\n    commentLikeApi({\n      user_id: sessionStorage.getItem('user_id'),\n      video_id,\n      type: '4'\n    }).then(res => {\n      if (res.err) {\n        Toast.info('请勿重复点赞', 1)\n        return\n      } else {\n        detailData2.fabulous_video = 1\n        detailData2.liked_num++\n        this.setState({\n          detailData: detailData2,\n        })\n      }\n    })\n  }\n\n  sendMsg = (e) => {\n    const { id } = this.props.match.params\n    const user_id = sessionStorage.getItem('user_id')  //万能ID '9652'  sessionStorage.getItem('user_id')\n    const video_id = id.split('&')[0]\n    if (e.keyCode === 13) {\n      if (this.state.message !== '') {\n        commentLikeApi({\n          user_id,\n          type: '2',\n          video_id,\n          message: this.state.message\n        }).then(res => {\n          if (res.suc) {\n            Toast.success(res.suc)\n            this.setState({\n              message: '',\n              isReload: true\n            })\n          }\n        })\n      } else {\n        return\n      }\n    }\n  }\n\n  cb = () => { // 提交评论后停止重复请求,以及在前台页面模拟数据变化减少数据请求,实际上后台以更新.\n    const detailData = this.state.detailData\n    detailData.comment_num++\n    this.setState({\n      isReload: false,\n      detailData\n    })\n  }\n\n  saveMsg = (e) => {\n    this.setState({ message: e.target.value })\n  }\n\n  collectBtn = () => {\n    const { id } = this.props.match.params\n    commentLikeApi({\n      user_id: sessionStorage.getItem('user_id'),\n      video_id: id.split('&')[0],\n      type: '1'\n    }).then(res => {\n      switch (res.suc) {\n        case '收藏成功':\n          this.setState({ isCollect: true })\n          Toast.success(res.suc, 1, false)\n          break;\n        case '取消成功':\n          this.setState({ isCollect: false })\n          Toast.success(res.suc, 1, false)\n          break;\n        default:\n          Toast.success('网络延迟,稍后在试')\n          return\n      }\n    })\n  }\n  render() {\n    const { videoDetailReducer } = this.props;\n    const { HotVideoList } = videoDetailReducer\n    const navBarProps = {\n      title: this.state.navBarTitle,\n      isDetail: true,\n      onLeftClick: this.onLeftClick,\n      display: this.state.display\n    }\n    const contentProps = {\n      likedClick: this.likedClick,\n      isLiked: this.state.isLiked,\n      isCollect: this.state.isCollect,\n      dataList: HotVideoList,\n      router: this.props,\n      getVideo: this.getVideo,\n      getChat: this.getChat,\n      detailData: this.state.detailData,\n      showComment: this.showComment,\n      collectBtn: this.collectBtn,\n    }\n    const modalProps = {\n      cb: this.cb,\n      commentNum: this.state.detailData.comment_num,\n      visible: this.state.visible,\n      onClose: () => this.setState({ visible: false }),\n      dataSource: this.props.videoDetailReducer.comment,\n      getChat: this.getChat,\n      detailData: this.state.detailData,\n      isReload: this.state.isReload\n    }\n    return (\n      <div className='playerIndex'>\n        <PublicNavBar  {...navBarProps} />\n        <div onClick={() => this.setState({ display: !this.state.display })} id='dplayer' />\n        <Content {...contentProps} />\n        <div className='InpBottomSay'>\n          <i className='iconPhoto' />\n          <input\n            onChange={this.saveMsg}\n            onKeyDown={this.sendMsg}\n            onFocus={() => this.setState({ visible: true })}\n            placeholder='我来说两句...'\n            type=\"text\"\n            value={this.state.message}\n          />\n        </div>\n        <ModalPlayer {...modalProps} />\n        {this.state.noLogin ? <IsLogin rightCallBack={this.closeLogin} /> : null}\n      </div>\n    )\n  }\n}\nexport default VideoDetail\n"]},"metadata":{},"sourceType":"module"}