{"ast":null,"code":"import \"antd-mobile/lib/list-view/style/css\";\nimport _ListView from \"antd-mobile/lib/list-view\";\n\nvar _class,\n    _temp,\n    _jsxFileName = \"/Users/gaomengzhou/Projects/kedou/src/pages/VideoDetail/components/ViewList.js\";\n\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { withRouter } from 'react-router-dom';\nimport { getChatApi } from '../../../services/videoDetail';\nimport ListContent from './ListContent';\n\nlet MyViewList = withRouter(_class = (_temp = class MyViewList extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.getDataInit = () => {\n      const hei = document.documentElement.clientHeight - ReactDOM.findDOMNode(this.lv).parentNode.offsetTop;\n      const id = this.props.match.params.id;\n      getChatApi({\n        page: '1',\n        rows: '10',\n        user_id: sessionStorage.getItem('user_id'),\n        video_id: id.split('&')[0]\n      }).then(res => {\n        this.setState({\n          commentList: res.comment,\n          dataSource: this.state.dataSource.cloneWithRows(res.comment),\n          isLoading: false,\n          height: hei\n        });\n      });\n    };\n\n    this.onEndReached = event => {\n      const id = this.props.match.params.id;\n      const dataList = this.state.commentList;\n\n      if (this.state.noMore) {\n        return;\n      }\n\n      getChatApi({\n        page: String(this.state.page + 1),\n        rows: '10',\n        user_id: sessionStorage.getItem('user_id'),\n        video_id: id.split('&')[0]\n      }).then(res => {\n        if (res.comment.length === 0) {\n          this.setState({\n            noMore: true,\n            page: '1'\n          });\n          return;\n        }\n\n        const commentList = dataList.concat(res.comment);\n        this.setState({\n          commentList,\n          dataSource: this.state.dataSource.cloneWithRows(commentList),\n          page: this.state.page + 1\n        });\n      });\n    };\n\n    this.state = {\n      noMore: false,\n      page: 1,\n      commentList: [],\n      dataSource: new _ListView.DataSource({\n        rowHasChanged: (row1, row2) => row1 !== row2\n      }),\n      hasMore: false,\n      //来自后端数据，指示是否为最后一页，这里为false\n      isLoading: true,\n      height: document.documentElement.clientHeight * 3 / 4\n    };\n  }\n\n  componentDidMount() {\n    this.getDataInit();\n  }\n\n  componentWillUpdate(nextProps, nextState) {\n    const id = this.props.match.params.id;\n\n    if (nextProps.isReload) {\n      getChatApi({\n        page: '1',\n        rows: '10',\n        user_id: sessionStorage.getItem('user_id'),\n        video_id: id.split('&')[0]\n      }).then(res => {\n        this.props.cb();\n\n        if (res) {\n          this.setState({\n            commentList: res.comment,\n            dataSource: this.state.dataSource.cloneWithRows(res.comment),\n            isLoading: false\n          });\n        }\n      });\n    }\n  }\n\n  render() {\n    const separator = (sectionID, rowID) => React.createElement(\"div\", {\n      key: `${sectionID}-${rowID}`,\n      style: {\n        backgroundColor: '#F5F5F9',\n        height: 8,\n        borderTop: '1px solid #ECECED',\n        borderBottom: '1px solid #ECECED'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98\n      },\n      __self: this\n    });\n\n    const row = (rowData, sectionID, rowID) => {\n      const listContentProps = {\n        getDataInit: this.getDataInit,\n        clickLike: this.clickLike,\n        rowData: rowData,\n        rowID: rowID\n      };\n      return React.createElement(ListContent, Object.assign({}, listContentProps, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 117\n        },\n        __self: this\n      }));\n    };\n\n    return React.createElement(_ListView, {\n      ref: el => this.lv = el,\n      dataSource: this.state.dataSource,\n      renderFooter: () => React.createElement(\"div\", {\n        style: {\n          textAlign: 'center'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 125\n        },\n        __self: this\n      }),\n      renderRow: row,\n      renderSeparator: separator,\n      style: {\n        height: this.state.height,\n        overflow: 'auto'\n      },\n      pageSize: 4 // onScroll={() => { console.log('scroll'); }}\n      ,\n      scrollRenderAheadDistance: 500,\n      onEndReached: this.onEndReached,\n      onEndReachedThreshold: 10,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 122\n      },\n      __self: this\n    });\n  }\n\n}, _temp)) || _class;\n\nexport default MyViewList;","map":{"version":3,"sources":["/Users/gaomengzhou/Projects/kedou/src/pages/VideoDetail/components/ViewList.js"],"names":["React","ReactDOM","withRouter","getChatApi","ListContent","MyViewList","Component","constructor","props","getDataInit","hei","document","documentElement","clientHeight","findDOMNode","lv","parentNode","offsetTop","id","match","params","page","rows","user_id","sessionStorage","getItem","video_id","split","then","res","setState","commentList","comment","dataSource","state","cloneWithRows","isLoading","height","onEndReached","event","dataList","noMore","String","length","concat","DataSource","rowHasChanged","row1","row2","hasMore","componentDidMount","componentWillUpdate","nextProps","nextState","isReload","cb","render","separator","sectionID","rowID","backgroundColor","borderTop","borderBottom","row","rowData","listContentProps","clickLike","el","textAlign","overflow"],"mappings":"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","sourcesContent":["/* eslint-disable array-callback-return */\nimport { ListView } from 'antd-mobile';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { withRouter } from 'react-router-dom';\nimport { getChatApi } from '../../../services/videoDetail';\nimport ListContent from './ListContent';\n@withRouter\nclass MyViewList extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      noMore: false,\n      page: 1,\n      commentList: [],\n      dataSource: new ListView.DataSource({\n        rowHasChanged: (row1, row2) => row1 !== row2,\n      }),\n      hasMore: false,//来自后端数据，指示是否为最后一页，这里为false\n      isLoading: true,\n      height: document.documentElement.clientHeight * 3 / 4,\n    };\n  }\n\n  componentDidMount() {\n    this.getDataInit()\n  }\n\n  componentWillUpdate(nextProps, nextState) {\n    const { id } = this.props.match.params\n    if (nextProps.isReload) {\n      getChatApi({\n        page: '1',\n        rows: '10',\n        user_id: sessionStorage.getItem('user_id'),\n        video_id: id.split('&')[0]\n      }).then(res => {\n        this.props.cb();\n        if (res) {\n          this.setState({\n            commentList: res.comment,\n            dataSource: this.state.dataSource.cloneWithRows(res.comment),\n            isLoading: false,\n          })\n        }\n      })\n    }\n  }\n\n  getDataInit = () => {\n    const hei = document.documentElement.clientHeight - ReactDOM.findDOMNode(this.lv).parentNode.offsetTop;\n    const { id } = this.props.match.params\n    getChatApi({\n      page: '1',\n      rows: '10',\n      user_id: sessionStorage.getItem('user_id'),\n      video_id: id.split('&')[0]\n    }).then(res => {\n      this.setState({\n        commentList: res.comment,\n        dataSource: this.state.dataSource.cloneWithRows(res.comment),\n        isLoading: false,\n        height: hei,\n      })\n    })\n  }\n\n  onEndReached = (event) => {\n    const { id } = this.props.match.params\n    const dataList = this.state.commentList\n    if (this.state.noMore) {\n      return\n    }\n    getChatApi({\n      page: String(this.state.page + 1),\n      rows: '10',\n      user_id: sessionStorage.getItem('user_id'),\n      video_id: id.split('&')[0]\n    }).then(res => {\n      if (res.comment.length === 0) {\n        this.setState({\n          noMore: true,\n          page: '1'\n        })\n        return\n      }\n      const commentList = dataList.concat(res.comment)\n      this.setState({\n        commentList,\n        dataSource: this.state.dataSource.cloneWithRows(commentList),\n        page: this.state.page + 1\n      })\n    })\n  }\n\n  render() {\n    const separator = (sectionID, rowID) => (\n      <div\n        key={`${sectionID}-${rowID}`}\n        style={{\n          backgroundColor: '#F5F5F9',\n          height: 8,\n          borderTop: '1px solid #ECECED',\n          borderBottom: '1px solid #ECECED',\n        }}\n      />\n    );\n\n    const row = (rowData, sectionID, rowID) => {\n      const listContentProps = {\n        getDataInit: this.getDataInit,\n        clickLike: this.clickLike,\n        rowData: rowData,\n        rowID: rowID\n      }\n      return (\n        <ListContent {...listContentProps} />\n      );\n    };\n\n    return (\n      <ListView\n        ref={el => this.lv = el}\n        dataSource={this.state.dataSource}\n        renderFooter={() => (<div style={{ textAlign: 'center' }}>\n          {/* {this.state.isLoading ? '加载中...' : '加载完毕'} */}\n        </div>)}\n        renderRow={row}\n        renderSeparator={separator}\n        style={{\n          height: this.state.height,\n          overflow: 'auto',\n        }}\n        pageSize={4}\n        // onScroll={() => { console.log('scroll'); }}\n        scrollRenderAheadDistance={500}\n        onEndReached={this.onEndReached}\n        onEndReachedThreshold={10}\n      />\n    );\n  }\n}\n\n\nexport default MyViewList\n"]},"metadata":{},"sourceType":"module"}